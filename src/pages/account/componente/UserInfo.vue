<template>
  <div class="userinfo">
    <div class="ee" v-if="$store.state.auth.dataset.user_profile_datas.user_nickname === 'e9eb971e-70bc-4e4e-bfd6-38046e326e29'">
      <p> ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß  </p><br>
     <p> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡∏≠‡∏á‡∏ó‡πà‡∏≤‡∏ô ‡∏à‡∏∂‡∏á‡∏à‡∏∞‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ ‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢‡πÉ‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏°‡πà‡∏™‡∏∞‡∏î‡∏ß‡∏Å‡∏Ñ‡∏£‡∏±‡∏ö‡∏ú‡∏° üôè</p><br>
     <div class="contor-input">
        <div class="from-title" >‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö üëà</div>
        <input  v-model="Obj.user_nickname"/>
      </div> <br>
      <div class="con-save">
        <div class="nv-btn-light-blue btn" @click="submit()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</div>
      </div>
      </div>
    <div class="from" v-else>
       <div class="contor-input-2">
        <div>
          <img :src="this.fileimg" width="200px">
          <div class="from-title" >‡∏£‡∏π‡∏õ ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</div>
          <input type="file"  @change="previewFiles" accept="image/png, image/jpeg, image/jpg"/>
        </div>
      </div> 
      <div class="contor-input">
        <div class="from-title" >‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</div>
        <input  v-model="Obj.user_nickname"/>
      </div> 
      <!-- <div class="con-from">
        <div class="contor-input">
          <div class="from-title">‡∏ä‡∏∑‡πà‡∏≠</div>
          <input v-model="Obj.first_name" />
        </div>
        <div class="contor-input">
          <div class="from-title">‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</div>
          <input  v-model="Obj.last_name"/>
        </div>
      </div> -->
      <!-- <div class="contor-input">
        <div class="from-title">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</div>
        <input :value="profile.username"/>
      </div>-->
      <div class="con-save">
        <div class="nv-btn-light-blue btn" @click="submit()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</div>
      </div>
    </div>
    <div class="from nv-mt-30">
        <div class="contor-input">
        <div class="from-title">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ <small class="requre">(‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠ Log In ‡πÅ‡∏ö‡∏ö‡∏õ‡∏Å‡∏ï‡∏¥‡πÑ‡∏î‡πâ) <span class="texthightlight">*‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏î‡πâ 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á*</span></small></div>
        <input v-model="ObjUsername.username"/>
        
      </div>
      <div class="contor-input">
        <div class="from-title" >‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πå</div>
        <input  :value="profile.email" disabled/>
      </div>
       <div class="con-save">
        <div class="nv-btn-light-blue btn" @click="ChangeUsername()">‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</div>
      </div>
    </div>
    <div class="from nv-mt-30">
      <div class="contor-input">
        <div class="from-title">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</div>
        <input type="password" v-model="ObjPassword.password" placeholder="********"/>
      </div>
      <div class="contor-input">
        <div class="from-title">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</div>
        <input type="password"  v-model="ObjPassword.Confirmpassword" placeholder="********"/>
      </div>
      <div class="con-save">
        <div class="nv-btn-light-blue btn" @click="ChangePassword()">‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</div>
      </div>
    </div>
    <div class="from nv-mt-30">
      <div class="con-save">
        <div class="nv-btn-light-blue btn" @click="clear()">‡∏•‡πâ‡∏≤‡∏á‡∏ô‡∏¥‡∏¢‡∏≤‡∏¢‡∏≠‡πà‡∏≤‡∏ô‡∏ï‡πà‡∏≠</div>
        <!-- <div class="nv-btn-light-blue btn" @click="ChangePassword()">‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</div> -->
      </div>
    </div>
  </div>
</template>
<script lang="ts">
import Vue from "vue";
import { Gatway } from "@/shares/services";
import { alert } from "@/shares/modules/alert";
import { sms_alert_Change_Password, sms_alert_Update_UserInformation } from "@/shares/constants/smsalert"
export default Vue.extend({
  name: "userinfo",
  data(){
    return{
      fileimg:'' as any,
      Obj:{
        first_name: this.$store.state.auth.dataset.user_profile_datas.first_name,
        id:this.$store.state.auth.dataset.user_profile_datas.id,
        last_name:this.$store.state.auth.dataset.user_profile_datas.last_name,
        user_id:this.$store.state.auth.dataset.id,
        user_img:this.$store.state.auth.dataset.user_profile_datas.id,
        user_nickname: this.$store.state.auth.dataset.user_profile_datas.user_nickname ? this.$store.state.auth.dataset.user_profile_datas.user_nickname : this.$store.state.auth.display_name,
        user_profile_data_type_id:'a406c04d-3f50-4ea8-986e-315452753638',
        // type_of_company_data_id:''
      }, 
      ObjPassword:{
        password:'',
        Confirmpassword:'',
      },
      ObjUsername:{
        id:this.$store.state.auth.dataset.id,
        username:this.$store.state.auth.dataset.username,
        status_change_username:true
      },
      FilesIDCard:'' as any
    }
  },
  methods:{
    async submit(){
      let res = await Gatway.postService('/customers/profile-data',  this.Obj as any )
      console.log(this.Obj);
      let formData = new FormData();
            formData.append("file", this.FilesIDCard as any);
            formData.append("ref", this.$store.state.auth.dataset.user_profile_datas.id);
            formData.append("table", "user_profile_data_user_img");
            await Gatway.postService(
              "/upload/image/ref-table",
              formData as any
            );
      if( res.data.code === 200){
        alert(sms_alert_Update_UserInformation.successful ,'success')
        this.$store.commit('reset') 
      }
    },
    async ChangeUsername(){
      let res = await Gatway.postService('/customers/user-info/change-username', this.ObjUsername as any)
      res.data.code === 200 
      ? alert(sms_alert_Update_UserInformation.successful, 'success') 
      : null
      //  await  this.submit()
      this.$store.commit('reset')
       
    },
    previewFiles(event) {
			var reader = new FileReader()
     this.FilesIDCard = event.target.files[0]
			reader.readAsDataURL(event.target.files[0])
			reader.onload = () => {
        this.fileimg = reader.result
			};
		},
    async ChangePassword(){
      if(this.ObjPassword.password.length >= 8){
        if(this.ObjPassword.password === this.ObjPassword.Confirmpassword){
          let data = await {
            id:this.$store.state.auth.dataset.id,
            password:this.ObjPassword.password,
            password_confirmation:this.ObjPassword.Confirmpassword
          }
          let res = await Gatway.postService('/customers/user-info/change-password', data as any)
          let test = JSON.stringify(res.data.data)
          res.data.code === 200 ? alert(sms_alert_Change_Password.successful, 'success') : alert(test,'error')
        }else{
          alert('Password ‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô','error')
        }
      }else{
         alert('Password ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 8 ‡∏ï‡∏±‡∏ß','error') 
      }
    },
    clear(){
     localStorage.removeItem("StoryRead");
    }
  },
  mounted(){
    // this.ChangePassword()
  }
});
</script>
<style lang="scss" scoped>

.btn {
  //   width: 120px;
  text-align: center;
  font-size: 13px;
  padding: 4px 7px;
}
.con-save {
  display: flex;
  justify-content: flex-end;
}
.requre{
  font-size: 12px;
  margin-left: 10px;
}
.texthightlight {
  color: #b80909;
}
.ee{
    color: #ffffff;
    padding: 10px;
    background: #ff4949;
     font-family: "Sarabun", sans-serif;
     border-radius: 5px;
}
  input[type="color"],
input[type="date"],
input[type="datetime"],
input[type="datetime-local"],
input[type="email"],
input[type="month"],
input[type="number"],
input[type="password"],
input[type="search"],
input[type="tel"],
input[type="text"],
input[type="time"],
input[type="url"],
input[type="week"],
input,
select:focus,
textarea {
  font-size: 16px;
}
.contor-input-2{
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
}
</style>
